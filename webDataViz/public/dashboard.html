<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="shortcut icon" href="assets/UndertaleHeart.png" type="image/x-icon">
    <link rel="stylesheet" href="./css/config.css">
    <link rel="stylesheet" href="./css/dashboard.css">
    <title>Dashboard</title>
</head>

<body>
    <div id="divBackgroundImg"><img src="assets/corridor.webp"></div>
    <header>
        <a href="index.html"><img src="assets/UndertaleHeart.png"></a>
    </header>
    <div id="mainframe">
        <div id="divCardDashboards">
            <div id="divVoltarParaLuta">
                <a href="fight.html">
                    <img src="assets/setaVoltar.png">
                    <p>Batalhar Novamente</p>
                </a>
            </div>
            <div id="divHeaderText">
                <h2 id="textReception">Olá <span id="spanUserName">"USER"</span>, este é o julgamento:</h2>
            </div>
            <div id="divKPIS">
                <div id="divKPIMortesToriel" class="kpiCard">
                    <p>Toriel morreu:</p>
                    <span id="spanDeadsToriel">100</span>
                    <p>vezes</p>
                </div>
                <div id="divKPIMortesPlayers" class="kpiCard">
                    <p>Toriel matou:</p>
                    <span id="spanKillsToriel">100</span>
                    <p>vezes</p>
                </div>
            </div>
            <div id="divCharts">
                <div class="charts">
                    <canvas id="killsChart"></canvas>
                </div>
                <div class="charts">
                    <canvas id="deadsChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    Chart.defaults.backgroundColor = '#FFFFFF';
    Chart.defaults.borderColor = '#FFFFFF';
    Chart.defaults.color = '#FFFFFF';

    let playerMatouToriel = false
    let playerPoupouEMatouToriel = false

    verificarBatalhasPassadas()
    function verificarBatalhasPassadas() {
        fetch("/usuarios/verificarBatalhas", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idServer: sessionStorage.ID_USUARIO
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                console.log(resposta);
                resposta.json().then(json => {
                    atoPrioritario = (json.atoPrioritario)
                    mortes = (json.mortes)
                });
            } else {
                resposta.text().then(texto => {
                    alert(texto);
                });
            }
        }).catch(function (erro) {
            console.log(erro);
        })
    }

    setTimeout(() => {
        if (atoPrioritario == "matou") {
            playerMatouToriel = true
        } else if (atoPrioritario == "poupou") {
            playerMatouToriel = false
        } else {
            playerMatouToriel = true
            playerPoupouEMatouToriel = true
        }
        if (playerMatouToriel && !playerPoupouEMatouToriel) {
            textReception.innerHTML = `<h2 id="textReception">Olá <span style="color:red">${nome}</span>, este é O julgamento:</h2>`
        } else if (playerPoupouEMatouToriel) {
            textReception.innerHTML = `<h2 id="textReception">Olá <span style="color:red">${nome} :)</span>, este é O julgamento:</h2>`
        } else {
            textReception.innerHTML = `<h2 id="textReception">Olá <span style="color:white">${nome}</span>, este é O julgamento:</h2>`
        }
    }, 100);

    const nome = sessionStorage.NOME_USUARIO

    new Chart(killsChart, {
        type: 'pie',
        data: {
            labels: ['Toriel foi morta', 'Toriel foi poupada'],
            datasets: [{
                data: [12, 19],
                backgroundColor: ["#000000", "#FFFFFF"]
            }]
        }
    });
    new Chart(deadsChart, {
        type: 'pie',
        data: {
            labels: ['Toriel Matou', 'Toriel Poupou'],
            datasets: [{
                data: [12, 19],
                backgroundColor: ["#000000", "#FFFFFF"]
            }]
        }
    });

</script>